<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="www.api.mba.auth.Auth">
	
	<insert id="insertJoin" parameterType="map">
	    INSERT INTO TB_USER
	    (
	        EMAIL,
	        PASSWORD_HASH,
	        USER_NM,
	        TELNO,
	        USER_STTS_CD,
	        EMAIL_VRFCT_AT,
	        PW_FAILR_CNT,
	        LAST_LOGIN_DT,
	        USE_AT,
	        CREATED_DT,
	        CREATED_BY,
	        UPDATED_DT,
	        UPDATED_BY,
	        AUTH_TYPE
	    )
	    VALUES
	    (
	        #{email},
	        #{passwordHash},
	        #{userNm},
	        #{telno},
	        'ACTIVE',        -- 기본값
	        'N',             -- 이메일 인증여부
	        0,               -- 실패횟수
	        NULL,            -- 마지막 로그인
	        'Y',             -- 사용여부
	        NOW(),           -- 생성일시
	        #{createdBy},    -- 생성자
	        NOW(),           -- 수정일시
	        #{updatedBy},    -- 수정자
	        'U'              -- 가입 타입(일반)
	    )
	</insert>

    <!-- 로그인 -->
    <select id="selectLogin" parameterType="map" resultType="CamelHashMap">
    /* www.api.mba.auth.Auth.selectLogin */
	    SELECT USER_ID, EMAIL, PASSWORD_HASH, USER_NM, TELNO,
	           USER_STTS_CD, EMAIL_VRFCT_AT, PW_FAILR_CNT,
	           LAST_LOGIN_DT, USE_AT, CREATED_DT, CREATED_BY,
	           UPDATED_DT, UPDATED_BY, AUTH_TYPE
	    FROM TB_USER
	    WHERE EMAIL = #{email}
	        AND PASSWORD_HASH = #{passwordHash}
	        AND USE_AT = 'Y'
	    LIMIT 1
    </select>
    
    
        <!-- 로그인 -->
    <select id="duplicateId" parameterType="map" resultType="CamelHashMap">
    /* www.api.mba.auth.Auth.duplicateId */
	    SELECT COUNT(*) AS cnt 
	    FROM TB_USER
	    WHERE EMAIL = #{email}
	    AND USE_AT = 'Y'
	    LIMIT 1
    </select>


</mapper>